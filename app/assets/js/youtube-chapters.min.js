/*!
 * youtube-chapters
 * A YouTube chapter generator
 * 
 * @author Vijay Dubb
 * @version 2.0.0
 * Copyright 2013. MIT licensed.
 */
!function(a,b,c){"use strict";function d(a,b){if(!(this instanceof d))return new d(a,b);this.element=a,this.options=b;for(var c=0;c<j.length;c++)if(j[c]===this.element)throw new Error("An instance of YTChapter with element "+this.element+" already exists.");if(!this.element||"string"!=typeof this.element)throw new Error("Element has not been set, please set element");if(h(this.element).length<1)throw new Error("Element "+this.element+" does not exsit.");if(b=e(b,{}),f(b.chapters))throw new Error("All ID's must be unqiue");this.ytc={},this.randomNumber=Math.floor(99999*Math.random()),this.ytc.element="youtube-iframe-"+this.randomNumber,this.ytc.player=null,this.ytc.options={youtubeId:e(b.youtubeId,"bHQqvYy5KYo"),fluid:e(b.fluid,!1),playerVars:e(b.playerVars,{}),height:e(b.height,"100%"),width:e(b.width,"100%"),showTime:e(b.showTime,!1),chapters:e(b.chapters,[])},this._init()}function e(a,b){return a&&"undefined"!=typeof a?a:b}function f(a){if(!a)return!1;var b=a.map(function(a){return a.id});return b.some(function(a,c){return b.indexOf(a)!==c})}function g(a){var b=a.replace(/ /g,"").match(/(\d+h)?(\d+m)?(\d+s)?/);return b[0]?3600*(parseInt(b[1],10)||0)+60*(parseInt(b[2],10)||0)+(parseInt(b[3],10)||0):(b=a.split(":"),b.length>2?3600*parseInt(b[0],10)+60*parseInt(b[1],10)+1*parseInt(b[2],10):60*parseInt(b[0],10)+1*parseInt(b[1],10))}function h(a){return this instanceof h?(this.element=c.querySelectorAll(a),void(this.length=this.element.length)):new h(a)}var i,j=[],k=d.prototype;k._init=function(){j.push(this.element),this._buildStruture()._addChapters()._addYouTubeVideo()},k._buildStruture=function(){return h(this.element).attr({style:"max-width:"+this.ytc.options.width}).add("div",{"class":"youtube-video-"+this.randomNumber+(this.ytc.options.fluid?" fluid-wrapper":"")}).add("div",{"class":"chapters-wrapper-"+this.randomNumber}),h(".youtube-video-"+this.randomNumber).add("div",{"class":this.ytc.element,id:this.ytc.element}),this},k._addChapters=function(){for(var a=this,b=function(b){b.preventDefault(),a.ytc.player.seekTo(b.currentTarget.getAttribute("data-time")),setTimeout(function(){a.ytc.player.playVideo()},500)},c=h(".chapters-wrapper-"+a.randomNumber),d=0;d<a.ytc.options.chapters.length;d++){var e=a.ytc.options.chapters[d];c.add("div",{"class":"chapter-"+e.id}),h(".chapter-"+e.id).add("div",{"class":"chapter-point",id:e.id,href:e.id,"data-time":g(e.time)},e.title).next().addEvent("click",b).add("span",{"class":"time"},a.ytc.options.showTime?e.time:"")}return this},k._addYouTubeVideo=function(){function a(){var a=event.data;(150===a||101===a)&&b.alert("Error: An error has occurred"),event.target.stopVideo()}function d(a){var b=h(".chapter-point"),c=function(){b.each(function(a,b,c){b.classList.remove("current");var d=b.getAttribute("data-time"),f=null;f=c[a+1]?c[a+1].getAttribute("data-time"):e.ytc.player.getDuration(),e.ytc.player.getCurrentTime()>d&&e.ytc.player.getCurrentTime()<f&&b.classList.add("current")})};switch(a.data){case YT.PlayerState.PLAYING:i=setInterval(c,500);break;case YT.PlayerState.UNSTARTED:case YT.PlayerState.BUFFERING:case YT.PlayerState.CUED:break;case YT.PlayerState.PAUSED:case YT.PlayerState.ENDED:clearInterval(i);break;default:throw new Error("Something went wrong.")}}var e=this,f=c.createElement("script");f.src="https://www.youtube.com/iframe_api";var g=c.getElementsByTagName("script")[0];return g.parentNode.insertBefore(f,g),b.onYouTubeIframeAPIReady=function(){e.ytc.player=new YT.Player(e.ytc.element,{height:e.ytc.options.height,width:e.ytc.options.width,videoId:e.ytc.options.youtubeId,playerVars:e.ytc.options.playerVars,events:{onReady:function(){},onStateChange:d,onError:a}})},this},h.prototype.add=function(a,b,d){var e=c.createElement(a);if(b&&this.attr(b,e),d&&(e.innerText=d),this.element.length)for(var f=0;f<this.element.length;f++)this.element[f].appendChild(e);else this.element.appendChild(e);return this},h.prototype.addEvent=function(a,b){return this.element.addEventListener(a,b,!0),this},h.prototype.each=function(a){for(var b,c=0;c<this.length&&(b=a.call(this.element[c],c,this.element[c],this.element),b!==!1);c++);return this},h.prototype.next=function(){return this.element=this.element[0].firstChild,this},h.prototype.attr=function(a,b){if("string"==typeof a)return this.element[0].getAttribute(a);for(var c in a)if(a.hasOwnProperty(c))if(b)b.setAttribute(c,a[c]);else for(var d=0;d<this.element.length;d++)this.element[d].setAttribute(c,a[c]);return this},b.YTC=d}(this,window,document);